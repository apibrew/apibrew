"use strict";(self.webpackChunkgeekdoc=self.webpackChunkgeekdoc||[]).push([[431],{8431:function(e,t,s){s.r(t),s.d(t,{diagram:function(){return I}});var o=s(1453),r=s(5625),i=s(5740),a=s(4560),n=s(66),d=s(3364),c=s(3622);s(7856),s(1941),s(2890),s(9368),s(7967);const l="rect",p="rectWithTitle",g="statediagram",b=`${g}-state`,h="transition",u=`${h} note-edge`,y=`${g}-note`,f=`${g}-cluster`,w=`${g}-cluster-alt`,x="parent",$="note",m="state",T="----",k=`${T}${$}`,S=`${T}${x}`,D="fill:none",v="fill: #333",A="text",B="normal";let E={},C=0;function R(e="",t=0,s="",o=T){const r=null!==s&&s.length>0?`${o}${s}`:"";return`${m}-${e}${r}-${t}`}const V=(e,t,s,r,i,n)=>{const d=s.id,c=null==(g=r[d])?"":g.classes?g.classes.join(" "):"";var g;if("root"!==d){let t=l;!0===s.start&&(t="start"),!1===s.start&&(t="end"),s.type!==o.a&&(t=s.type),E[d]||(E[d]={id:d,shape:t,description:a.d.sanitizeText(d,(0,a.g)()),classes:`${c} ${b}`});const r=E[d];s.description&&(Array.isArray(r.description)?(r.shape=p,r.description.push(s.description)):r.description.length>0?(r.shape=p,r.description===d?r.description=[s.description]:r.description=[r.description,s.description]):(r.shape=l,r.description=s.description),r.description=a.d.sanitizeTextOrArray(r.description,(0,a.g)())),1===r.description.length&&r.shape===p&&(r.shape=l),!r.type&&s.doc&&(a.l.info("Setting cluster for ",d,M(s)),r.type="group",r.dir=M(s),r.shape=s.type===o.b?"divider":"roundedWithTitle",r.classes=r.classes+" "+f+" "+(n?w:""));const i={labelStyle:"",shape:r.shape,labelText:r.description,classes:r.classes,style:"",id:d,dir:r.dir,domId:R(d,C),type:r.type,padding:15};if(s.note){const t={labelStyle:"",shape:"note",labelText:s.note.text,classes:y,style:"",id:d+k+"-"+C,domId:R(d,C,$),type:r.type,padding:15},o={labelStyle:"",shape:"noteGroup",labelText:s.note.text,classes:r.classes,style:"",id:d+S,domId:R(d,C,x),type:"group",padding:0};C++;const a=d+S;e.setNode(a,o),e.setNode(t.id,t),e.setNode(d,i),e.setParent(d,a),e.setParent(t.id,a);let n=d,c=t.id;"left of"===s.note.position&&(n=t.id,c=d),e.setEdge(n,c,{arrowhead:"none",arrowType:"",style:D,labelStyle:"",classes:u,arrowheadStyle:v,labelpos:"c",labelType:A,thickness:B})}else e.setNode(d,i)}t&&"root"!==t.id&&(a.l.trace("Setting node ",d," to be child of its parent ",t.id),e.setParent(d,t.id)),s.doc&&(a.l.trace("Adding nodes children "),N(e,s,s.doc,r,i,!n))},N=(e,t,s,r,i,n)=>{a.l.trace("items",s),s.forEach((s=>{switch(s.stmt){case o.c:case o.a:V(e,t,s,r,i,n);break;case o.S:{V(e,t,s.state1,r,i,n),V(e,t,s.state2,r,i,n);const o={id:"edge"+C,arrowhead:"normal",arrowTypeEnd:"arrow_barb",style:D,labelStyle:"",label:a.d.sanitizeText(s.description,(0,a.g)()),arrowheadStyle:v,labelpos:"c",labelType:A,thickness:B,classes:h};e.setEdge(s.state1.id,s.state2.id,o,C),C++}}}))},M=(e,t=o.e)=>{let s=t;if(e.doc)for(let t=0;t<e.doc.length;t++){const o=e.doc[t];"dir"===o.stmt&&(s=o.value)}return s},z={setConf:function(e){const t=Object.keys(e);for(const s of t)e[s]},getClasses:function(e,t){a.l.trace("Extracting classes"),t.db.clear();try{return t.parser.parse(e),t.db.extract(t.db.getRootDocV2()),t.db.getClasses()}catch(e){return e}},draw:function(e,t,s,p){a.l.info("Drawing state diagram (v2)",t),E={};let b=p.db.getDirection();void 0===b&&(b=o.D);const{securityLevel:h,state:u}=(0,a.g)(),y=u.nodeSpacing||50,f=u.rankSpacing||50;a.l.info(p.db.getRootDocV2()),p.db.extract(p.db.getRootDocV2()),a.l.info(p.db.getRootDocV2());const w=p.db.getStates(),x=new r.k({multigraph:!0,compound:!0}).setGraph({rankdir:M(p.db.getRootDocV2()),nodesep:y,ranksep:f,marginx:8,marginy:8}).setDefaultEdgeLabel((function(){return{}}));let $;V(x,void 0,p.db.getRootDocV2(),w,p.db,!0),"sandbox"===h&&($=(0,i.Ys)("#i"+t));const m="sandbox"===h?(0,i.Ys)($.nodes()[0].contentDocument.body):(0,i.Ys)("body"),T=m.select(`[id="${t}"]`),k=m.select("#"+t+" g");(0,n.r)(k,x,["barb"],g,t),c.u.insertTitle(T,"statediagramTitleText",u.titleTopMargin,p.db.getDiagramTitle());const S=T.node().getBBox(),D=S.width+16,v=S.height+16;T.attr("class",g);const A=T.node().getBBox();(0,d.c)(T,v,D,u.useMaxWidth);const B=`${A.x-8} ${A.y-8} ${D} ${v}`;a.l.debug(`viewBox ${B}`),T.attr("viewBox",B);const C=document.querySelectorAll('[id="'+t+'"] .edgeLabel .label');for(const e of C){const t=e.getBBox(),s=document.createElementNS("http://www.w3.org/2000/svg",l);s.setAttribute("rx",0),s.setAttribute("ry",0),s.setAttribute("width",t.width),s.setAttribute("height",t.height),e.insertBefore(s,e.firstChild)}}},I={parser:o.p,db:o.d,renderer:z,styles:o.s,init:e=>{e.state||(e.state={}),e.state.arrowMarkerAbsolute=e.arrowMarkerAbsolute,o.d.clear()}}}}]);