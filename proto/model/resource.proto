syntax = "proto3";

package model;

option go_package = "github.com/tislib/data-handler/pkg/model";

import 'model/audit.proto';
import 'model/query.proto';
import 'model/common.proto';
import 'model/security.proto';
import 'google/protobuf/struct.proto';

enum AutoGenerationType {
  NONE = 0;
  IDENTITY = 1;
  RANDOMIZED_UUID = 2;
}

enum ResourcePropertyType {
  TYPE_BOOL = 0;
  TYPE_STRING = 1;
  TYPE_FLOAT32 = 2;
  TYPE_FLOAT64 = 3;
  TYPE_INT32 = 4;
  TYPE_INT64 = 5;
  TYPE_BYTES = 6;
  TYPE_UUID = 8;
  TYPE_DATE = 9;
  TYPE_TIME = 10;
  TYPE_TIMESTAMP = 11;
  TYPE_OBJECT = 12;
  TYPE_MAP = 13;
  TYPE_LIST = 14;
  TYPE_REFERENCE = 15;
  TYPE_ENUM = 16;
}

message ResourceProperty {
  string name = 1; // uniq(per resource) // name
  ResourcePropertyType type = 2;
  string mapping = 3;
  bool required = 5;
  bool primary = 6;
  uint32 length = 7;
  bool unique = 8;
  SecurityContext securityContext = 9;
  google.protobuf.Value defaultValue = 10;
  google.protobuf.Value enumValues = 11; // if type is enum
  Reference reference = 12; // if type is reference
  ResourcePropertyType subType = 13; // if type is map or list

  map<string, string> annotations = 103;
}

message Reference {
  string referencedResource = 2;
  bool cascade = 3;
}

message ResourceSourceConfig {
  string dataSource = 1;
  string catalog = 2;
  string entity = 3;
}

message Resource {
  string id = 1; // id; read only
  string name = 2; // uniq(per namespace) // name
  string namespace = 3; // create only?
  DataType dataType = 4; // read only
  ResourceSourceConfig sourceConfig = 5;
  repeated ResourceProperty properties = 6;
  SecurityContext securityContext = 10;
  bool virtual = 11;

  AuditData auditData = 101;
  uint32 version = 102;
  map<string, string> annotations = 103;
}
