syntax = "proto3";

package stub.model;

option go_package = "data-handler/model";

import 'model/audit.proto';
import 'model/query.proto';
import 'model/common.proto';


message ResourcePropertyComputedSourceConfig {
  //  FunctionCall functionCall = 1;
}

enum AutoGenerationType {
  NONE = 0;
  IDENTITY = 1;
  RANDOMIZED_UUID = 2;
}

message ResourcePropertyMappingConfig {
  string mapping = 1;
  string sourceDef = 2;
  AutoGenerationType autoGeneration = 5;
}

enum ResourcePropertyType {
  TYPE_BOOL = 0;
  TYPE_STRING = 1;
  TYPE_FLOAT = 2;
  TYPE_DOUBLE = 3;
  TYPE_INT32 = 4;
  TYPE_INT64 = 5;
  TYPE_BYTES = 6;
  TYPE_TEXT = 7;
  TYPE_UUID = 8;
  TYPE_DATE = 9;
  TYPE_TIME = 10;
  TYPE_TIMESTAMP = 11;
  TYPE_OBJECT = 12;
  TYPE_NUMERIC = 13;
  TYPE_PASSWORD = 14;
}

message ResourceProperty {
  string name = 1; // uniq(per resource) // name
  ResourcePropertyType type = 2;
  oneof sourceConfig {
    ResourcePropertyMappingConfig mapping = 3;
    ResourcePropertyComputedSourceConfig computed = 4; // not implemented
  }
  bool required = 5;
  bool primary = 6;
  uint32 length = 7;
  bool unique = 8;
}

message ResourceCheck {
  BooleanExpression check = 1;
  bool permissive = 2; // if permissive, instead of rejecting payload, we will log it
}

message ResourceReference {
  string propertyName = 1;
  string referencedResource = 2;
  bool cascade = 3;
}

enum ResourceIndexType {
  BTREE = 0;
  HASH = 1;
}

message ResourceIndex {
  repeated string propertyNames = 1;
  bool unique = 2;
  ResourceIndexType indexType = 3;
}

message ResourceSourceConfig {
  string dataSource = 1;
  string mapping = 2;
}

message ResourceFlags {
  bool readOnlyRecords = 1;
  bool uniqueRecord = 2;
  bool keepHistory = 3;
  bool autoCreated = 4;
  bool disableMigration = 5;
  bool disableAudit = 6;
  bool doPrimaryKeyLookup = 7;
}

message Resource {
  string id = 1; // id; read only
  string name = 2; // uniq(per namespace) // name
  string namespace = 3; // create only?
  DataType dataType = 4; // read only
  ResourceSourceConfig sourceConfig = 5;
  repeated ResourceProperty properties = 6;
  repeated ResourceCheck checks = 7; // not implemented
  repeated ResourceReference references = 8; // not implemented
  repeated ResourceIndex indexes = 9; // not implemented
  ResourceFlags flags = 10;

  AuditData auditData = 101;
  uint32 version = 102;
}
